<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手 | eternal-bug的博客</title><meta name="author" content="eternal-bug"><meta name="copyright" content="eternal-bug"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="介绍RAG RAG全名为Retrieval Augmented Generation，翻译为检索增强生成。通俗的理解为：给大模型一本">
<meta property="og:type" content="article">
<meta property="og:title" content="LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手">
<meta property="og:url" content="https://eternal-bug.github.io/posts/10f93d59.html">
<meta property="og:site_name" content="eternal-bug的博客">
<meta property="og:description" content="介绍RAG RAG全名为Retrieval Augmented Generation，翻译为检索增强生成。通俗的理解为：给大模型一本">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://eternal-bug.github.io/img/avatar.png">
<meta property="article:published_time" content="2024-06-21T13:23:56.000Z">
<meta property="article:modified_time" content="2024-06-23T12:42:39.959Z">
<meta property="article:author" content="eternal-bug">
<meta property="article:tag" content="LangChain">
<meta property="article:tag" content="RAG">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://eternal-bug.github.io/img/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://eternal-bug.github.io/posts/10f93d59.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-23 20:42:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="eternal-bug的博客" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-timeline"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-layer-group"></i><span> 分类</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Perl/"><i class="fa-fw fas fa-code"></i><span> Perl</span></a></li><li><a class="site-page child" href="/categories/Python/"><i class="fa-fw fas fa-code"></i><span> Python</span></a></li><li><a class="site-page child" href="/categories/R/"><i class="fa-fw fas fa-code"></i><span> R</span></a></li><li><a class="site-page child" href="/categories/%E5%8D%9A%E5%AE%A2/"><i class="fa-fw fas fa-blog"></i><span> 博客</span></a></li><li><a class="site-page child" href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"><i class="fa-fw fas fa-microchip"></i><span> 大模型</span></a></li><li><a class="site-page child" href="/categories/%E8%AE%BE%E8%AE%A1/"><i class="fa-fw fas fa-pen-ruler"></i><span> 设计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/statistics/"><i class="fa-fw fas fa-chart-simple"></i><span> 统计</span></a></li><li><a class="site-page child" href="/bioinformatics/"><i class="fa-fw fas fa-dna"></i><span> 生信</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-sliders"></i><span> 多媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/game/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/starbound.half.png')"><nav id="nav"><span id="blog-info"><a href="/" title="eternal-bug的博客"><span class="site-name">eternal-bug的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-timeline"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-layer-group"></i><span> 分类</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/Perl/"><i class="fa-fw fas fa-code"></i><span> Perl</span></a></li><li><a class="site-page child" href="/categories/Python/"><i class="fa-fw fas fa-code"></i><span> Python</span></a></li><li><a class="site-page child" href="/categories/R/"><i class="fa-fw fas fa-code"></i><span> R</span></a></li><li><a class="site-page child" href="/categories/%E5%8D%9A%E5%AE%A2/"><i class="fa-fw fas fa-blog"></i><span> 博客</span></a></li><li><a class="site-page child" href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"><i class="fa-fw fas fa-microchip"></i><span> 大模型</span></a></li><li><a class="site-page child" href="/categories/%E8%AE%BE%E8%AE%A1/"><i class="fa-fw fas fa-pen-ruler"></i><span> 设计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/statistics/"><i class="fa-fw fas fa-chart-simple"></i><span> 统计</span></a></li><li><a class="site-page child" href="/bioinformatics/"><i class="fa-fw fas fa-dna"></i><span> 生信</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-sliders"></i><span> 多媒体</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/game/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-06-21T13:23:56.000Z" title="发表于 2024-06-21 21:23:56">2024-06-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-23T12:42:39.959Z" title="更新于 2024-06-23 20:42:39">2024-06-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/">大模型</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">30</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>1分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="介绍rag">介绍RAG</h2>
<p>RAG全名为<code>Retrieval Augmented Generation</code>，翻译为检索增强生成。通俗的理解为：<mark class="hl-label default">给大模型一本<strong style="color:yellow" "="">精炼</strong>的参考书，让它在回答问题时优先去查参考书，之后拿着查询好的内容再结合它自身的知识整合一下给你答案"</mark> 。</p>
<p><img src="/posts/10f93d59/RAG%E5%9B%BE%E7%A4%BA.png" alt="RAG流程图示"></p>
<p>那大模型训练的时候使用了非常多的文本，很可能已经包含了你所需要的知识，而且它还有更强的整合能力<mark class="hl-label pink">为什么还需要外部知识库呢？</mark> </p>
<ul>
<li>
<mark class="hl-label green">模型存在幻觉</mark> ：用过大模型查科研问题的都会碰到过GPT张嘴乱说的情况，看起来它给的引文有模有样，甚至比你想要了解的内容还要，结果一搜压根没有，论文作者呢是能查到，结果一搜出来你是想查人类相关医学文献，它给你整的作者是兽医相关（开玩笑的，其实有时候是化学物理专业的作者）。这就是”幻觉“，从另外一面来看这也是大模型拥有创造力的原因，目前来说是一个技术难题。“幻觉”在很多领域是不能被容忍的，比如法律行业、金融行业、医药行业。
</li>
<li>
<mark class="hl-label green">私有知识库</mark> ：有的机构、公司、个人拥有私有知识库，不希望这些知识库泄露，用这样的方式就比较好，而且还能随时更新。微调模型当然可以做到，但是每次更新知识库就需要微调模型。
</li>
<li>
<mark class="hl-label green">模型上下文有限</mark> ：现在都在增加输入给模型的上下文长度，最近刚发布的ChatGlm4最长可以支持1M的上下文，经过评测大海捞针（Needle In A Haystack）的准确性还挺高的。那为什么还需要这种外部知识库呢，直接把知识库全部给它，让他自己去查不行吗？一是运行时间很长，二是token多了花钱比较多，三是推理能力还不够强，复杂知识无法较好呈现，四是很长的上下文得到的结果不一定会好。后面需要技术的更进一步迭代才有可能解决这些问题。
</li>
<li>
<mark class="hl-label green">模型专业领域深度不够</mark> ：训练的知识可能过时，在专业领域可能深度不够（有时候我觉得还行，难道是我深度不够🤪？）。
</li>
</ul>
<h2 id="参照">参照</h2>
<p>本文主要按照这个B站视频进行，主要代码按照视频来。因为我是用的本地模型构建的RAG所以部分代码有所不同：</p>
<iframe src="//player.bilibili.com/player.html?isOutside=true&amp;aid=112608724126262&amp;bvid=BV1rYGDeiEzx&amp;cid=500001580596819&amp;p=1&amp;as_wide=1&amp;high_quality=1&amp;danmaku=0&amp;autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="500" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"></iframe>
<div class="note info simple"><p>Up主主要是利用了一个外部网页的知识（民法典），通过联网抓取网页之后提取出其中的文本，经过文本片段提取向量化存储，基于人工询问的问题从库中抓取内容，将其作为上下文和提问一并输入给在线的大模型（OpenAI ChatGPT）进行内容整合输出。这是一个常见的简单的RAG应用，用来入门我觉得不错。</p>
</div>
<h2 id="环境搭建">环境搭建</h2>
<p>可以看<a href="https://eternal-bug.github.io/posts/ae6567a8.html">上一篇文章</a>搭建好ChatGlm3的本地部署。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 激活一下环境</span></span><br><span class="line">conda activate ChatGLM3</span><br></pre></td></tr></tbody></table></figure>
<p>打开一下API服务：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python api_server.py</span><br></pre></td></tr></tbody></table></figure>
<p>之后推荐安装一下<code>jupyter lab</code>，比较方便查看变量和运行过程（安装过程不赘述）：</p>
<details class="toggle" style="border: 1px solid grey"><summary class="toggle-button" style="background-color: grey;color: white">jupyter lab安装步骤</summary><div class="toggle-content"><p>首先安装ipykernal：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple jupyterlab ipykernel</span><br></pre></td></tr></tbody></table></figure>
<p>增添jupyter lab的运行环境：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m ipykernel install --user --name ChatGLM3 --display-name <span class="string">"ChatGLM3"</span></span><br></pre></td></tr></tbody></table></figure></div></details>
<p>下面的代码可以在jupyter lab中逐步运行，也可以在python脚本中执行。</p>
<h2 id="库导入">库导入</h2>
<p>还需要安装一些其他的库：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple langserve</span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple beautifulsoup4</span><br><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple chromadb</span><br></pre></td></tr></tbody></table></figure>
<p>导入库：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bs4</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain_community.document_loaders <span class="keyword">import</span> WebBaseLoader</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.prompts.prompt <span class="keyword">import</span> PromptTemplate</span><br><span class="line"><span class="keyword">from</span> langchain_core.output_parsers <span class="keyword">import</span> StrOutputParser</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables <span class="keyword">import</span> RunnablePassthrough</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里不使用OpenAI的Chat模型和embedding</span></span><br><span class="line"><span class="comment"># from langchain_openai import OpenAIEmbeddings</span></span><br><span class="line"><span class="comment"># from langchain_openai import ChatOpenAI</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> langserve <span class="keyword">import</span> add_routes</span><br><span class="line"><span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_community.llms.chatglm3 <span class="keyword">import</span> ChatGLM3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br></pre></td></tr></tbody></table></figure>
<p>后面再解释这些库的作用。</p>
<h2 id="数据处理">数据处理</h2>
<p>使用的数据来源于网上，需要先访问到对应网站，再使用网页解析器得到想要的文本，全部的文本一般比较长，需要分片，分片之后转换为向量（embedding），把向量保存到数据库中。</p>
<h3 id="抓取">抓取</h3>
<p>网址为：<a target="_blank" rel="noopener" href="https://www.gov.cn/xinwen/2020-06/01/content_5516649.htm">中华人民共和国民法典</a>。</p>
<p><img src="/posts/10f93d59/%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9.jpg" alt="RAG流程图示"></p>
<p>需要把网页内的需要的文本抓取出来。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_web_doc</span>(<span class="params">url, nid</span>):</span><br><span class="line">    <span class="comment"># langchain封装的网页内容抓取器</span></span><br><span class="line">    loader = WebBaseLoader(web_path=url, bs_kwargs=<span class="built_in">dict</span>(parse_only=bs4.SoupStrainer(<span class="built_in">id</span>=nid)))</span><br><span class="line">    docs = loader.load()</span><br><span class="line">    <span class="keyword">return</span> docs</span><br><span class="line"></span><br><span class="line">docs = load_web_doc(url=<span class="string">"https://www.gov.cn/xinwen/2020-06/01/content_5516649.htm"</span>, nid=<span class="string">"UCAP-CONTENT"</span>)</span><br></pre></td></tr></tbody></table></figure>
<p><code>nid</code>的确定主要是按<code>F12</code>查看网页源码，发现主要的内容块位于<code>UCAP-CONTENT</code>的<code>div</code>下面：</p>
<p><img src="/posts/10f93d59/%E7%BD%91%E9%A1%B5Div.jpg" alt=""></p>
<p>其实可以自己去写一个简单的网页爬虫把网页文本爬下来，这个<code>WebBaseLoader</code>暂时用一下，比较复杂的网站还是要自己写程序去抓取的。</p>
<div class="note info simple"><p>LangChain内置了很多文档解析器，比如这里的网页抓取工具，还有pdf解析工具，txt文本读取工具，markdown读取工具等等。</p>
</div>
<p>把文档打印一下看看：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(docs), <span class="built_in">type</span>(docs))</span><br><span class="line"><span class="comment"># 1 &lt;class 'list'&gt;</span></span><br><span class="line"><span class="built_in">print</span>(docs[<span class="number">0</span>].page_content[<span class="number">0</span>:<span class="number">100</span>])</span><br><span class="line"><span class="comment"># 新华社北京6月1日电</span></span><br><span class="line"><span class="comment"># 中华人民共和国民法典</span></span><br><span class="line"><span class="comment"># （2020年5月28日第十三届全国人民代表大会第三次会议通过）</span></span><br><span class="line"><span class="comment"># 目录</span></span><br><span class="line"><span class="comment"># 第一编　总则</span></span><br><span class="line"><span class="comment"># 第一章　基本规定</span></span><br><span class="line"><span class="comment"># 第二章　自然人</span></span><br><span class="line"><span class="comment"># 第一节　民事权利能力和民事行为能力</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="文本切割">文本切割</h3>
<p>就是把一长段文本划分为一小段一小段的片段，片段之间允许重叠，比如说以<code>20</code>个字符为一个切割块（<code>chunk</code>），不同切割块之间重叠（<code>overlap</code>）<code>5</code>个字符：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">原始 ：扁担宽，板凳长，扁担想绑在板凳上，板凳不让扁担绑在板凳上，扁担偏要绑在板凳上，板凳偏偏不让扁担绑在那板凳上，到底扁担宽还是板凳长</span><br><span class="line">－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－</span><br><span class="line">片段1：扁担宽，板凳长，扁担想绑在板凳上，板凳不</span><br><span class="line">片段2：　　　　　　　　　　　　　　　上，板凳不让扁担绑在板凳上，扁担偏要绑在</span><br><span class="line">片段3：　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　担偏要绑在板凳上，板凳偏偏不让扁担绑在那</span><br><span class="line">片段4：　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　扁担绑在那板凳上，到底扁担宽还是板凳长</span><br></pre></td></tr></tbody></table></figure>
<p>这个其实非常像我们做生信的对于基因组的处理，一般基因组非常的长就把基因组分割成短的片段，非常短的叫做<code>kmer</code>，长的叫做<code>segment</code>，为了防止前后两个片段的关联丢失，常常会让他们重叠一定的长度。</p>
<details class="toggle" style="border: 1px solid grey"><summary class="toggle-button" style="background-color: grey;color: white">基因组划分为kmer</summary><div class="toggle-content"><p>基因组划分为kmer，一般overlap等于<code>kmer的长度 - 1</code>：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Genome: ATGCAGCTACGAT</span><br><span class="line">kmer1 : ATGCAGCTAC</span><br><span class="line">kmer2 :  TGCAGCTACG</span><br><span class="line">kmer3 :   GCAGCTACGA</span><br><span class="line">kmer4 :    CAGCTACGAT</span><br></pre></td></tr></tbody></table></figure>
</div></details>
<p>将上面网页抓取的文本进行以<code>1000</code>字符为块长度，不同块之间重叠<code>200</code>长度。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">split_docs</span>(<span class="params">docs</span>):</span><br><span class="line">    text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="number">1000</span>, chunk_overlap=<span class="number">200</span>)</span><br><span class="line">    splits = text_splitter.split_documents(docs)</span><br><span class="line">    <span class="keyword">return</span> splits</span><br><span class="line"></span><br><span class="line">doc_splits = split_docs(docs)</span><br></pre></td></tr></tbody></table></figure>
<div class="note warning simple"><p>看了一些博客很多人说这里的参数对于后续结果影响很大，如果想要提升RAG的效果，这里的参数是需要调整的。</p>
</div>
<p>打印一下结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(doc_splits), <span class="built_in">type</span>(doc_splits))</span><br><span class="line"><span class="comment"># 139 &lt;class 'list'&gt;</span></span><br><span class="line"><span class="built_in">print</span>(doc_splits[<span class="number">0</span>].page_content)</span><br><span class="line"><span class="comment"># 新华社北京6月1日电</span></span><br><span class="line"><span class="comment"># 中华人民共和国民法典</span></span><br><span class="line"><span class="comment"># （2020年5月28日第十三届全国人民代表大会第三次会议通过）</span></span><br><span class="line"><span class="comment"># 目录</span></span><br><span class="line"><span class="comment"># 第一编　总则</span></span><br><span class="line"><span class="comment"># 第一章　基本规定</span></span><br><span class="line"><span class="comment"># 第二章　自然人</span></span><br><span class="line"><span class="comment"># 第一节　民事权利能力和民事行为能力</span></span><br><span class="line"><span class="comment"># 第二节　监护</span></span><br><span class="line"><span class="comment"># 第三节　宣告失踪和宣告死亡</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></tbody></table></figure>
<p>划分得到了<code>139</code>个切割块。使用<code>page_content</code>属性访问具体内容。</p>
<h3 id="向量化">向量化</h3>
<p>在向量化之前，需要定义一个类，原本的langchain的<code>HuggingFaceEmbeddings</code>死活就加载不了，路径明明给对了还仍然要去下载模型文件，搜了一下报错发现老外也有这个问题，我看了一下对应位置的langchain源码，发现很简单，我稍微调整了重写了一下类就可以用了，顺带回答了一下老外的问题<a target="_blank" rel="noopener" href="https://github.com/PromtEngineer/localGPT/discussions/338">#338</a>，原来老外也是有小白的啊，应该比我白。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自己把原本的HuggingFaceEmbeddings进行修改</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SentenceTransformerMy</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line">    encode_kwargs = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="comment"># See also the Sentence Transformer documentation: https://sbert.net/docs/package_reference/SentenceTransformer.html#sentence_transformers.SentenceTransformer.encode"""</span></span><br><span class="line">    multi_process: <span class="built_in">bool</span> = <span class="literal">False</span></span><br><span class="line">    <span class="string">"""Run encode() on multiple GPUs."""</span></span><br><span class="line">    show_progress: <span class="built_in">bool</span> = <span class="literal">False</span></span><br><span class="line">    <span class="string">"""Whether to show a progress bar."""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_path, **kwargs</span>):</span><br><span class="line">        self.client = SentenceTransformer(model_path, **kwargs)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">embed_documents</span>(<span class="params">self, texts</span>):</span><br><span class="line">            <span class="string">"""Compute doc embeddings using a HuggingFace transformer model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            Args:</span></span><br><span class="line"><span class="string">                texts: The list of texts to embed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            Returns:</span></span><br><span class="line"><span class="string">                List of embeddings, one for each text.</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line"></span><br><span class="line">            texts = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.replace(<span class="string">"\n"</span>, <span class="string">" "</span>), texts))</span><br><span class="line">            <span class="keyword">if</span> self.multi_process:</span><br><span class="line">                pool = self.client.start_multi_process_pool()</span><br><span class="line">                embeddings = self.client.encode_multi_process(texts, pool)</span><br><span class="line">                sentence_transformers.SentenceTransformer.stop_multi_process_pool(pool)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                embeddings = self.client.encode(</span><br><span class="line">                    texts, show_progress_bar=self.show_progress, **self.encode_kwargs</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> embeddings.tolist()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">embed_query</span>(<span class="params">self, text: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">"""Compute query embeddings using a HuggingFace transformer model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            text: The text to embed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Embeddings for the text.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.embed_documents([text])[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>向量化的目的是什么？</p>
<p><img src="/posts/10f93d59/%E7%9F%A5%E8%AF%86%E6%A3%80%E7%B4%A2.jpg" alt="知识检索"></p>
<p>这里可以理解为把文档数字化一串数值，也叫做embedding（具体的embedding将会单独写一篇文章介绍），便于计算机处理。</p>
<p>比如：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">你好吗？： [1.2, 2.5]</span><br><span class="line">最近怎么样？：[1.3, 2.45]</span><br><span class="line">早上好！：[1.1, 2.45]</span><br><span class="line">我喜欢杯子蛋糕：[3.1, 1.4]</span><br></pre></td></tr></tbody></table></figure>
<p>将这样转化之后，通过计算这一串数值之间的余弦相似度就可以得到两个句子之间的相似性，假如维度只有2的话，绘制在坐标系上通过位置可以知道句子是相似还是有差异。</p>
<p><img src="/posts/10f93d59/%E6%96%87%E6%A1%A3%E5%90%91%E9%87%8F%E5%8C%96.jpg" alt="文档向量化"></p>
<p>所以到这里也就可以知道上面开头流程图里面的<strong>相似性查询</strong>是怎样的，比如我问”我醉酒驾驶会怎么样？“，首先把用户输入的内容转换为embedding，然后和数据库里面的文档对应的embedding计算余弦相似度，最后把最为相似的几条文档拿出来就是<strong>精炼的参考书</strong>。</p>
<div class="note info simple"><p>也就是说，<strong>任何搜索过程都可用于检索</strong>，你可以不使用这里的langchain定义的Chroma数据库搜索的方式，自己设计一个数据检索方式。任何接受用户输入并返回一些结果的方法都可以。例如，可以尝试查找与用户问题相匹配的文本并将其发送给 LLM，或者用百度搜索该问题并发送最佳结果，顺便说一句，这大致就是 Bing 聊天机器人的工作原理。</p>
</div>
<p>保存，就是把不同的切割块转换为的embedding向量保存到<code>Chroma</code>数据库中，具体这个数据库是什么暂时不管，总之就是现在向量化数据保存的其中之一的一个数据库。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上一篇文章中提到过这个embedding模型，具体的路径你可能需要更改一下</span></span><br><span class="line">embedding_model = SentenceTransformerMy(<span class="string">"../models/Xorbits/bge-m3"</span>, device=<span class="string">"cuda"</span>)</span><br><span class="line"><span class="comment"># 测试一下改写的类能不能用</span></span><br><span class="line">embedding_model.embed_documents([<span class="string">"你好"</span>, <span class="string">"这里是eternal-bug"</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">store_docs</span>(<span class="params">docs, embedding_model</span>):</span><br><span class="line">    <span class="comment"># 不用OpenAI的embedding模型</span></span><br><span class="line">    <span class="comment"># embedding = OpenAIEmbeddings()</span></span><br><span class="line">    vecs = Chroma.from_documents(documents=docs, embedding=embedding_model, persist_directory=<span class="string">"./chroma_db"</span>)</span><br><span class="line">    <span class="keyword">return</span> vecs</span><br><span class="line"></span><br><span class="line">doc_vectorstore = store_docs(doc_splits, embedding_model)</span><br></pre></td></tr></tbody></table></figure>
<p>打开<code>./chroma_db</code>，发现有几个文件：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tree ./chroma_db</span><br><span class="line"></span><br><span class="line">./chroma_db/</span><br><span class="line">├── 508fd8b0-d69b-4c62-aa09-964d96d7c95b</span><br><span class="line">│ ├── data_level0.bin</span><br><span class="line">│ ├── header.bin</span><br><span class="line">│ ├── length.bin</span><br><span class="line">│ └── link_lists.bin</span><br><span class="line">└── chroma.sqlite3</span><br></pre></td></tr></tbody></table></figure>
<p>其中<code>.sqlite3</code>是常见的简单的非登录的数据库文件。除此之外还有几个bin文件不太清楚是做什么的，可能是为了便于快速进行余弦相似度计算的一些东西。</p>
<h2 id="问答">问答</h2>
<h3 id="构建问答链">构建问答链</h3>
<p>定义模板是非常有讲究的，prompt工程对于模型的影响会很大，这里着重强调了<strong>使用以下检索到的上下文来回答问题。如果你不知道答案，就说不知道</strong>。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_rag_chain</span>(<span class="params">vectorstore</span>):</span><br><span class="line">    prompt_template_str = <span class="string">"""</span></span><br><span class="line"><span class="string">    你是民法典问答任务的助手。使用以下检索到的上下文来回答问题。如果你不知道答案，就说不知道。保持答案简洁，答案不要超过三个句子。</span></span><br><span class="line"><span class="string">    问题：{question}</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    上下文：{context}</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    答案：</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    prompt_template = PromptTemplate.from_template(prompt_template_str)</span><br><span class="line">    <span class="comment"># 基于问题和数据库中的数据进行搜索，一般是基于向量之间的余弦相似度进行计算的</span></span><br><span class="line">    retriever = vectorstore.as_retriever(search_type=<span class="string">"similarity"</span>, search_kwargs={<span class="string">"k"</span>: <span class="number">4</span>})</span><br><span class="line">    <span class="comment"># 和上一篇文章一样构建一个本地的LLM对象</span></span><br><span class="line">    llm = ChatGLM3(endpoint_url=<span class="string">"http://127.0.0.1:8000/v1/chat/completions"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 为了将检索到的文档做一下分段</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">format_docs</span>(<span class="params">docs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"\n\n"</span>.join(doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构建一个链条</span></span><br><span class="line">    rag_chain = (</span><br><span class="line">        {<span class="string">"context"</span>: retriever | format_docs, <span class="string">"question"</span>: RunnablePassthrough()}</span><br><span class="line">        | prompt_template</span><br><span class="line">        | llm</span><br><span class="line">        | StrOutputParser()</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> rag_chain</span><br></pre></td></tr></tbody></table></figure>
<p>这里的链条要比上一篇文章里面提到的简单链条要复杂很多，里面还用了链条的嵌套。首先是<code>{"context": retriever | format_docs, "question": RunnablePassthrough()}</code>，<code>retriever</code>是检索到的文档，经过<code>format_docs</code>函数进行格式化，<code>RunnablePassthrough()</code>是一个在执行的时候再解释输入的函数，它接受了下面的”根据民法典，捐助人反悔如何拿回捐款“的问题，组成好字典之后，给模板<code>prompt_template</code>中的变量进行替换，后续的过程就和之前文章中提到的情况类似了。</p>
<h3 id="测试">测试</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成rag链条</span></span><br><span class="line">rag_chain = build_rag_chain(doc_vectorstore)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试结果😄</span></span><br><span class="line"><span class="built_in">print</span>(rag_chain.invoke(<span class="string">"根据民法典，捐助人反悔如何拿回捐款"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据民法典，捐助人反悔拿回捐款的具体方式如下：</span></span><br><span class="line"><span class="comment">#     1. 首先，赠与附义务的，受赠人应当按照约定履行义务。如果受赠人对赠与的财产有瑕疵，赠与人不承担责任。附义务的赠与，赠与的财产有瑕疵的，赠与人在附义务的范围内承担与卖出人相同的责任。赠与人故意不告知瑕疵或者保证无瑕疵，造成受赠人损失的，应当承担赔偿责任。</span></span><br><span class="line"><span class="comment">#     2. 如果受赠人有下列情形之一，赠与人可以撤销赠与：（一）严重侵害赠与人或者赠与人近亲属的合法权益；（二）对赠与人有扶养义务而不履行；（三）不履行赠与合同约定的义务。赠与人的撤销权，自知道或者应当知道撤销事由之日起一年内行使。</span></span><br><span class="line"><span class="comment">#     3. 因受赠人的违法行为致使赠与人死亡或者丧失民事行为能力的，赠与人的继承人或者法定代理人可以撤销赠与。赠与人的继承人或者法定代理人的撤销权，自知道或者应当知道撤销事由之日起六个月内行使。</span></span><br><span class="line"><span class="comment">#     4. 撤销权人撤销赠与的，可以向受赠人请求返还赠与的财产。</span></span><br><span class="line"><span class="comment">#     5. 如果赠与人的经济状况显著恶化，严重影响其生产经营或者家庭生活的，可以不再履行赠与义务。</span></span><br></pre></td></tr></tbody></table></figure>
<p>每一次输出的结果会有一些不同，如果需要是有必要要对这个过程做优化的。</p>
<p>再试一下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(rag_chain.invoke(<span class="string">"根据民法典，不熟读民法典会怎么样"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据民法典，不熟读民法典可能会导致在发生纠纷时无法准确主张自己的权益，从而可能影响维权效果。因此，熟读民法典有助于公民更好地维护自身合法权益。</span></span><br></pre></td></tr></tbody></table></figure>
<div class="note warning simple"><p>显存大约占据<code>21G</code>，如果中途爆显存不够，把<code>ChatGlm3API</code>关掉，这个jupyter lab笔记本<code>Restart kernel</code>。</p>
</div>
<p>如果想要查看通过embedding查询到了哪些内容，可以把上面的函数改一下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">format_docs</span>(<span class="params">docs</span>):</span><br><span class="line">    text = <span class="string">"\n\n"</span>.join(doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> docs)</span><br><span class="line">    <span class="comment"># 打印出来一下看看</span></span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></tbody></table></figure>
<p>比如最开始一个问题”捐助人反悔如何拿回捐款“查询到的内容：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">依据前款规定应当交付的赠与财产因赠与人故意或者重大过失致使毁损、灭失的，赠与人应当承担赔偿责任。</span><br><span class="line">第六百六十一条　赠与可以附义务。</span><br><span class="line">赠与附义务的，受赠人应当按照约定履行义务。</span><br><span class="line">第六百六十二条　赠与的财产有瑕疵的，赠与人不承担责任。附义务的赠与，赠与的财产有瑕疵的，赠与人在附义务的限度内承担与出卖人相同的责任。</span><br><span class="line">赠与人故意不告知瑕疵或者保证无瑕疵，造成受赠人损失的，应当承担赔偿责任。</span><br><span class="line">第六百六十三条　受赠人有下列情形之一的，赠与人可以撤销赠与：</span><br><span class="line">（一）严重侵害赠与人或者赠与人近亲属的合法权益；</span><br><span class="line">（二）对赠与人有扶养义务而不履行；</span><br><span class="line">（三）不履行赠与合同约定的义务。</span><br><span class="line">赠与人的撤销权，自知道或者应当知道撤销事由之日起一年内行使。</span><br><span class="line">第六百六十四条　因受赠人的违法行为致使赠与人死亡或者丧失民事行为能力的，赠与人的继承人或者法定代理人可以撤销赠与。</span><br><span class="line">赠与人的继承人或者法定代理人的撤销权，自知道或者应当知道撤销事由之日起六个月内行使。</span><br><span class="line">第六百六十五条　撤销权人撤销赠与的，可以向受赠人请求返还赠与的财产。</span><br><span class="line">第六百六十六条　赠与人的经济状况显著恶化，严重影响其生产经营或者家庭生活的，可以不再履行赠与义务。</span><br><span class="line">第十二章　借款合同</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>
<p>还是比较相关的，因为这个是固定流程不会出现变数。</p>
<h2 id="网页应用">网页应用</h2>
<p>整体上的逻辑不变，就是用FastAPI构建了一个网页UI：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主要的模型，embedding向量都有了</span></span><br><span class="line"><span class="comment"># 这里生成网页UI就是固定的写法，暂时没必要深究</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_app</span>(<span class="params">rag_chain</span>):</span><br><span class="line">    app = FastAPI(</span><br><span class="line">        title = <span class="string">"中国民法典助手"</span>,</span><br><span class="line">        version=<span class="number">0.1</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 添加路由，路由类似于文件路径一样</span></span><br><span class="line">    <span class="comment"># civil_law_ai名字可以自己取</span></span><br><span class="line">    add_routes(</span><br><span class="line">        app,</span><br><span class="line">        rag_chain,</span><br><span class="line">        path=<span class="string">"/civil_law_ai"</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line">app = create_app(rag_chain)</span><br><span class="line"><span class="comment"># 如果是本机运行，host="127.0.0.1"</span></span><br><span class="line"><span class="comment"># 端口自己设置</span></span><br><span class="line">uvicorn.run(app, host=<span class="string">"0.0.0.0"</span>, port=<span class="number">10004</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>这个在jupyter lab中不能正常运行，需要把上面所有的代码都放在脚本中然后在命令行运行，命令行出现下面的情况表示成功：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">USER_AGENT environment variable not set, consider setting it to identify your requests.</span><br><span class="line">INFO:     Started server process [3809065]</span><br><span class="line">INFO:     Waiting for application startup.</span><br><span class="line"></span><br><span class="line"> __          ___      .__   __.   _______      _______. _______ .______     ____    ____  _______</span><br><span class="line">|  |        /   \     |  \ |  |  /  _____|    /       ||   ____||   _  \    \   \  /   / |   ____|</span><br><span class="line">|  |       /  ^  \    |   \|  | |  |  __     |   (----`|  |__   |  |_)  |    \   \/   /  |  |__</span><br><span class="line">|  |      /  /_\  \   |  . `  | |  | |_ |     \   \    |   __|  |      /      \      /   |   __|</span><br><span class="line">|  `----./  _____  \  |  |\   | |  |__| | .----)   |   |  |____ |  |\  \----.  \    /    |  |____</span><br><span class="line">|_______/__/     \__\ |__| \__|  \______| |_______/    |_______|| _| `._____|   \__/     |_______|</span><br><span class="line"></span><br><span class="line">LANGSERVE: Playground for chain "/civil_law_ai/" is live at:</span><br><span class="line">LANGSERVE:  │</span><br><span class="line">LANGSERVE:  └──&gt; /civil_law_ai/playground/</span><br><span class="line">LANGSERVE:</span><br><span class="line">LANGSERVE: See all available routes at /docs/</span><br></pre></td></tr></tbody></table></figure>
<p>在浏览器中访问：<code>http://服务器地址:10004/civil_law_ai/playground/</code>，其中<code>civil_law_ai</code>就是我们自己起的名字。</p>
<h3 id="测试">测试</h3>
<div class="tabs" id="测试"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#测试-1">1.正经问题</button></li><li class="tab"><button type="button" data-href="#测试-2">2.失业问题</button></li><li class="tab"><button type="button" data-href="#测试-3">3.脑筋急转弯</button></li><li class="tab"><button type="button" data-href="#测试-4">4.常识问题</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="测试-1"><p><img src="/posts/10f93d59/%E9%97%AE%E9%A2%980.jpg" alt=""></p>
<p>还行，经检查和原文一摸一样</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="测试-2"><p><img src="/posts/10f93d59/%E9%97%AE%E9%A2%981.jpg" alt=""></p>
<p>原本以为民法典有失业的内容，其实没有，这里是模型根据自己的知识回答的。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="测试-3"><p><img src="/posts/10f93d59/%E9%97%AE%E9%A2%982.jpg" alt=""></p>
<p>没想到原本严肃的律师也还有天真的一面！</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="测试-4"><p><img src="/posts/10f93d59/%E9%97%AE%E9%A2%983.jpg" alt=""></p>
<p>成功被我带跑偏，你这律师是不是有点讨好型人格。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<p>经测试和视频中的结果有点偏差，特别是最后三个和民法典无关的问题，”狗子喜欢吃香蕉吗？“这个问题视频中直接回答的是”不知道“，而且按照我给与的提示词也不能回答其他的内容。这里就和预期不相符，看来ChatGlm3和ChatGPT还是有一些差距的。</p>
<hr>
<hr>
<p>我写完文章后，深思了许久…，这不是可以考虑去当个辩护律师啊！拿着我这个工具，当着审判长的面儿，跑到法庭往那儿一站，桌子一拍，我：“异议！”。</p>
<p><img src="/posts/10f93d59/%E5%BC%82%E8%AE%AE.jpg" alt="异议"></p>
<p>结果可想而知🤔，拿这个工具做出回答应该比出示”律师徽章“好不到哪儿去。</p>
<p><img src="/posts/10f93d59/%E5%BE%8B%E5%B8%88%E5%BE%BD%E7%AB%A0.jpg" alt="律师徽章"></p>
<h2 id="参考">参考</h2>
<p><a target="_blank" rel="noopener" href="https://scriv.ai/guides/retrieval-augmented-generation-overview/">How do domain-specific chatbots work? An Overview of Retrieval Augmented Generation (RAG)</a></p>
<p>图片更改自：<br>
<a target="_blank" rel="noopener" href="https://neo4j.com/developer-blog/fine-tuning-retrieval-augmented-generation/">Knowledge Graphs &amp; LLMs: Fine-Tuning vs. Retrieval-Augmented Generation</a><br>
<a target="_blank" rel="noopener" href="https://www.reddit.com/r/LangChain/comments/161685i/retrieval_augmented_generation_using_langchain/">Retrieval Augmented Generation using Langchain</a></p>
<script src="https://giscus.app/client.js" data-repo="eternal-bug/giscus" data-repo-id="R_kgDOMHOH6Q" data-category="Announcements" data-category-id="DIC_kwDOMHOH6c4Cf-m4" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async="">
</script></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://eternal-bug.github.io">eternal-bug</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://eternal-bug.github.io/posts/10f93d59.html">https://eternal-bug.github.io/posts/10f93d59.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://eternal-bug.github.io" target="_blank">eternal-bug的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/LangChain/">LangChain</a><a class="post-meta__tags" href="/tags/RAG/">RAG</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/67e74819.html" title="过度封装的LangChain？一个小白的吐槽"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">过度封装的LangChain？一个小白的吐槽</div></div></a></div><div class="next-post pull-right"><a href="/posts/ae6567a8.html" title="LangChain + 本地ChatGLM3模型构建一条简单Chain"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">LangChain + 本地ChatGLM3模型构建一条简单Chain</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/67e74819.html" title="过度封装的LangChain？一个小白的吐槽"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-23</div><div class="title">过度封装的LangChain？一个小白的吐槽</div></div></a></div><div><a href="/posts/ae6567a8.html" title="LangChain + 本地ChatGLM3模型构建一条简单Chain"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-19</div><div class="title">LangChain + 本地ChatGLM3模型构建一条简单Chain</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">eternal-bug</div><div class="author-info__description">一个喜欢牵着骆驼、带着闪亮R形状戒指的白菜哥。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/eternal-bug"><i class="fab fa-github"></i><span>关注我</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8Drag"><span class="toc-number">1.</span> <span class="toc-text">介绍RAG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7"><span class="toc-number">2.</span> <span class="toc-text">参照</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E5%AF%BC%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">库导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%93%E5%8F%96"><span class="toc-number">5.1.</span> <span class="toc-text">抓取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E5%88%87%E5%89%B2"><span class="toc-number">5.2.</span> <span class="toc-text">文本切割</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%8C%96"><span class="toc-number">5.3.</span> <span class="toc-text">向量化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E7%AD%94"><span class="toc-number">6.</span> <span class="toc-text">问答</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%97%AE%E7%AD%94%E9%93%BE"><span class="toc-number">6.1.</span> <span class="toc-text">构建问答链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">6.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E5%BA%94%E7%94%A8"><span class="toc-number">7.</span> <span class="toc-text">网页应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">7.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/67e74819.html" title="过度封装的LangChain？一个小白的吐槽">过度封装的LangChain？一个小白的吐槽</a><time datetime="2024-06-23T03:21:47.000Z" title="发表于 2024-06-23 11:21:47">2024-06-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/10f93d59.html" title="LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手">LangChain + 本地ChatGLM3模型构建RAG应用1：法律助手</a><time datetime="2024-06-21T13:23:56.000Z" title="发表于 2024-06-21 21:23:56">2024-06-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/ae6567a8.html" title="LangChain + 本地ChatGLM3模型构建一条简单Chain">LangChain + 本地ChatGLM3模型构建一条简单Chain</a><time datetime="2024-06-19T14:06:36.000Z" title="发表于 2024-06-19 22:06:36">2024-06-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/e4f5c24f.html" title="清华智谱Chat-glm4模型服务器本地部署">清华智谱Chat-glm4模型服务器本地部署</a><time datetime="2024-06-15T08:15:32.000Z" title="发表于 2024-06-15 16:15:32">2024-06-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2c428f3d.html" title="最新stable diffusion3模型服务器本地部署">最新stable diffusion3模型服务器本地部署</a><time datetime="2024-06-14T10:57:24.000Z" title="发表于 2024-06-14 18:57:24">2024-06-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/starbound.half.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By eternal-bug</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">你好！欢迎来到<a href="https://eternal-bug.github.io">我的博客</a>。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>